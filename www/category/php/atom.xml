<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: PHP | CXH.ME]]></title>
  <link href="http://cxh.me/category/php/atom.xml" rel="self"/>
  <link href="http://cxh.me/"/>
  <updated>2014-01-06T22:03:50+08:00</updated>
  <id>http://cxh.me/</id>
  <author>
    <name><![CDATA[Harry Chen]]></name>
    <email><![CDATA[sdqxcxh@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Apache地址重写的几个问题]]></title>
    <link href="http://cxh.me/2012/04/02/some-problems-about-apache-address-rewrite/"/>
    <updated>2012-04-02T00:00:00+08:00</updated>
    <id>http://cxh.me/2012/04/02/some-problems-about-apache-address-rewrite</id>
    <content type="html"><![CDATA[<h1></h1>

<p>Apache地址重写的配置分为两种方式即通过httpd.conf配置和.htaccess文件。</p>

<p>首先要打开rewrite模块windows下的配置是</p>

<blockquote><p>LoadModule rewrite_module modules/mod_rewrite.so</p></blockquote>

<p>httpd.conf的配置可以全局生效也可以只配置一个目录需要做的事情是在相应目录的Directory标签下配置Rewrite规则。</p>

<p>.htaccess的则放到相应目录下或者根目录即可这是VPS里常用的一种方式毕竟作为一个VPS购买者不可能要求提供商去更改全局配置文件。这种方式需要注意的有如下两点</p>

<p>首先.htaccess要想起作用必须要在httpd.conf中相应的Directory标签下配置AllowOverride All默认是None其次是windows下这种无文件名仅有扩展名的文件是无法直接生成的可以在cmd窗口下使用copy con命令来生成这命令也有年头了我小学的时候还学过光阴荏苒啊扯远了…Ctrl Z保存。</p>

<p><img src="http://www.roybit.com/wp-content/uploads/2012/04/image_thumb.png" title="image" alt="image" /></p>

<p>然后我们说一下几个概念。</p>

<p>首先是RewriteEngine这是地址重写的引擎可以方便的设置为On或者Off来启用和关闭引擎。</p>

<p>其次是RewriteCond地址重写的条件符合这个条件的才进行表达式判断和重写这样能有效减少匹配的条数提高重写效率。</p>

<p>最后是RewriteBase和RewriteRuleRewriteBase指明重定向地址的基础即RewriteRule后一部分重定向地址会拼合上RewriteBase合成一个完整的重定向地址。这在一个web容器下有多个网站的时候比较有用。</p>

<p>RewriteRule才是我们讨论的主要话题。RewriteRule实现把符合表达式的地址重定向到另一个地址的功能RewriteRule的语法类似于下面</p>

<blockquote><p>RewriteRule ^forum-([0-9] )&ndash;([0-9] )\.html$ forumdisplay.php?fid=$1&amp;page=$2</p></blockquote>

<p>RewriteRule紧跟着判断表达式之后是需要重定向的位置正则表达式()会捕获一个分组然后通过$n引用这个分组从而实现地址重写。RewriteRule匹配的开始位置是整个URL去掉当前目录后剩下的部分比如我在/discuz配置上面所示的RewriteRule然后输入一个URL-<a href="http://localhost/discuz/forum-1-1.html%E8%A2%AB%E7%94%A8%E6%9D%A5%E5%8C%B9%E9%85%8D%E7%9A%84%E8%BE%93%E5%85%A5%E4%BC%9A%E6%98%AFforum-1-1.html%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%89%8D%E9%9D%A2%E7%9A%84/discuz/%E8%A2%AB%E5%90%83%E6%8E%89%E4%BA%86%E3%80%82%E5%AF%B9%E4%BA%8E%E6%95%B4%E4%B8%AA%E9%97%AE%E9%A2%98%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%A6%82%E4%B8%8B%E7%9A%84%E8%AF%AD%E5%8F%A5%E9%AA%8C%E8%AF%81%E3%80%82">http://localhost/discuz/forum-1-1.html%E8%A2%AB%E7%94%A8%E6%9D%A5%E5%8C%B9%E9%85%8D%E7%9A%84%E8%BE%93%E5%85%A5%E4%BC%9A%E6%98%AFforum-1-1.html%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%89%8D%E9%9D%A2%E7%9A%84/discuz/%E8%A2%AB%E5%90%83%E6%8E%89%E4%BA%86%E3%80%82%E5%AF%B9%E4%BA%8E%E6%95%B4%E4%B8%AA%E9%97%AE%E9%A2%98%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%A6%82%E4%B8%8B%E7%9A%84%E8%AF%AD%E5%8F%A5%E9%AA%8C%E8%AF%81%E3%80%82</a></p>

<blockquote><p>RewriteRule ^(.*)/forum-([0-9] )&ndash;([0-9] )\.html$ rewrite.php?param=$1</p>

<p>注在rewrite.php里打印一下GET[&lsquo;param’]参数</p></blockquote>

<p>另外这里需要说明的是如果我定义了</p>

<blockquote><p>RewriteBase /discuz</p></blockquote>

<p>那么前面的<sup>forum</sup>-([0-9] )&ndash;([0-9] )\.html$不受影响但是后面会变成/discuz/forumdisplay.php?fid=$1&amp;page=$2。不过RewriteBase并不是必须的若有指定RewriteBase结果为RewriteBase 重定向地址否则为当前目录 重定向地址。这里当前目录指的是.htaccess所在目录使用.htaccess的时候或者Directory标签指定的目录使用httpd.conf的时候。</p>

<p>以上操作在windows下测试通过。</p>

<p>参考文献</p>

<p><a href="http://www.roybit.com/wp-content/uploads/2012/04/image_thumb.png" title="image">1</a>Apache中RewriteCond规则参数介绍</p>

<p><a href="http://hi.baidu.com/%D2%BB/blog/item/ace7f14e19851cc4d0c86af2.html">http://hi.baidu.com/һ/blog/item/ace7f14e19851cc4d0c86af2.html</a></p>

<p><a href="http://hi.baidu.com/%D2%BB/blog/item/ace7f14e19851cc4d0c86af2.html">2</a>RewriteRule-htaccess详细语法使用教程</p>

<p><a href="http://www.3code.cn/rewriterule-htaccess%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">http://www.3code.cn/rewriterule-htaccess详细语法使用教程/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows下64位PHP+Mysql+Apache的安装配置]]></title>
    <link href="http://cxh.me/2011/09/23/php-apache-mysql-configuration-under-windows-x64/"/>
    <updated>2011-09-23T00:00:00+08:00</updated>
    <id>http://cxh.me/2011/09/23/php-apache-mysql-configuration-under-windows-x64</id>
    <content type="html"><![CDATA[<h1></h1>

<p>实际上和32的差别并不大，写这篇文章的主要目的是给出可行的下载地址。</p>

<blockquote><p>PHPx64</p>

<p>Apachex64</p>

<p>Mysqlx64</p>

<p><a href="http://dl-sh-ocn-1.pchome.net/0t/fw/mysql-essential-5.0.90-winx64.rar" title="http://dl-sh-ocn-1.pchome.net/0t/fw/mysql-essential-5.0.90-winx64.rar">http://dl-sh-ocn-1.pchome.net/0t/fw/mysql-essential-5.0.90-winx64.rar
</a></p></blockquote>

<p>然后安装mysql，apache和php直接解压就行，php.ini做如下几处修改</p>

<pre><code>#扩展目录
extension_dir = "../php/ext"
#mysql扩展
extension=php_mysql.dll
#剩下的酌情自己配置
</code></pre>

<p>httpd.conf做如下几处修改</p>

<pre><code>#主目录
ServerRoot "D:/Program Files/httpd-2.2-x64"
#LoadPHP的模块
LoadModule php5_module "D:/Program Files/php/php5apache2_2.dll"
PHPIniDir "D:/Program Files/php/"
#文档目录
DocumentRoot "d:/temporary/php"
#文档目录的权限配置

#默认访问文件名
DirectoryIndex index.php default.php index.html
#解析文档类型，这里很重要，否则无法解析php
AddType application/x-httpd-php .php  .php4 .php5 .html
</code></pre>

<p>拷贝libmysql.dll（mysql的bin目录下）到system32和apache的bin目录。</p>

<p>以管理员身份运行命令行，执行如下命令</p>

<blockquote><p>httpd -k install</p></blockquote>

<p>在执行 httpd -k install 的时候，显示 The Apache2.2 service is successfully installed 表明已经安装成功。</p>

<p>然后执行</p>

<blockquote><p>httpd -k start</p></blockquote>

<p>启动apache即可。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[chrome自动发送邮件插件]]></title>
    <link href="http://cxh.me/2011/08/28/chrome-plugin-to-send-mails-automatically/"/>
    <updated>2011-08-28T00:00:00+08:00</updated>
    <id>http://cxh.me/2011/08/28/chrome-plugin-to-send-mails-automatically</id>
    <content type="html"><![CDATA[<h1></h1>

<p>写这个插件的最初的原因是实验室的网络无法同步Chrome书签，同时有时候需要与宿舍的笔记本同步一些文本信息，所以琢磨自己写一个同步插件。</p>

<p>但是偌大一个教育网，竟然找不到一个可用的在线存储服务，金山快盘已经叫嚣要开放API很久了，但是就是没见到官方的API手册。最后想来想去，干脆用邮件算了，最终的 程序结构如下：</p>

<p><img src="http://www.roybit.com/wp-content/uploads/2011/08/thumb.png" title="程序结构" alt="程序结构" /></p>

<p>Chrome插件的开发参考了ClickTrans<a href="http://www.roybit.com/wp-content/uploads/2011/08/thumb.png" title="程序结构">1</a>的开发，源码可以在<a href="http://www.roybit.com/wp-content/uploads/2011/08/chrome%E6%8F%92%E4%BB%B61.rar">这里</a>下载，使用的时候在浏览器里右键，就会有Save选项，如果选择了文本，就把文本发送到邮件，否则发送当前链接地址。具体实现不解释，可以参考代码，简单说下Chrome插件的一些东东。</p>

<p>Chrome插件实际上是一组JS的脚本 配置文件，可能还有Html的页面，Chrome本身提供一些API接口，剩下的就通过JS来操作页面元素实现。Chrome插件里比较重要的两个东东，一个是页面，包括了BackGround页，Popup页（Popup页又分Page_Action和Browser_Action），另一个是向页面注入的JS脚本。因为插件自己的脚本并不能直接操作Web页，所以必须要向页面注入一个脚本才能进行页面操作。Chrome的API可以通过这里<a href="http://www.roybit.com/wp-content/uploads/2011/08/chrome%E6%8F%92%E4%BB%B61.rar">2</a>查询，自己的脚本和注入脚本之间的通信参见ClickTrans<a href="http://www.roybit.com/wp-content/uploads/2011/08/thumb.png" title="程序结构">1</a>的文章。</p>

<p>最后不得不提的一个东西，JS本身是无法实现SMTP协议的，或者说没人做，需要发送邮件的时候必须借助其他Web语言，通过服务的形式调用，我是写了一个简单的PHP响应请求并发送邮件的程序，具体代码如下，重要的不是代码，而是PHP下mail的配置，详见配置win下的sendmail<a href="http://www.php.net/if">3</a></p>

<p>Chrome插件的代码里固定了一个邮件服务的地址，localhost/test/send.php，如果需要请自行更改然后打包，有空再做成可配置的，然后放到SinaAppEngine上，这样就方便访问了，否则总得本地起服务，太费劲了。</p>

<p>参考文献</p>

<p><a href="http://www.roybit.com/wp-content/uploads/2011/08/thumb.png" title="程序结构">1</a> 从无到有制作Chrome扩展：ClickTrans，</p>

<p><a href="http://www.roybit.com/wp-content/uploads/2011/08/chrome%E6%8F%92%E4%BB%B61.rar">2</a> Chrome扩展API参考，</p>

<p><a href="http://www.php.net/if">3</a> php mail函数在win下的使用，以及配置win下的sendmail</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于php编码一个弱弱的问题]]></title>
    <link href="http://cxh.me/2011/06/24/a-problem-about-php-encoding/"/>
    <updated>2011-06-24T00:00:00+08:00</updated>
    <id>http://cxh.me/2011/06/24/a-problem-about-php-encoding</id>
    <content type="html"><![CDATA[<h1></h1>

<p>晚上调Xpath的一个程序，从网页里读出来的数据然后显示到网页一直是乱码……乱码啊乱码……都快疯了，最后发现从来没想过这个问题：</p>

<p>你echo回来的网页，浏览器凭什么知道你的编码?</p>

<p>于是乎，指定一下header，保证跟你echo到网页的编码一致，就OK了……这个问题好囧。</p>

<blockquote><pre><code>header("Content-type: text/html; charset=gb2312");
</code></pre></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP模拟登陆人人]]></title>
    <link href="http://cxh.me/2011/06/23/php-login-into-renren-simulation/"/>
    <updated>2011-06-23T00:00:00+08:00</updated>
    <id>http://cxh.me/2011/06/23/php-login-into-renren-simulation</id>
    <content type="html"><![CDATA[<h1></h1>

<p>PHP的Curl组件可以完成模拟http请求并获取返回结果的功能，并支持SSL和cookie，我们可以用Curl模拟登陆一个网站，并获取登陆后的结果。这里我们用人人做个测试。人人实现了与开心账号互通之后，增加了一个验证服务器，所以需要先到验证服务器验证并获取跳转链接，同时保存cookie，之后请求网页的时候都加上cookie即可。</p>

<p>代码见附件，主要需要注意的几点如下：</p>

<ol>
<li> 登陆Https网站需要PHP支持SSL并生成服务器认可的证书。</li>
<li> 设置CURLOPT_FOLLOWLOCATION的目的是登陆成功后直接按照返回的跳转值跳转，并抓取之后的页面。</li>
<li><p> 代码
<a href="http://www.roybit.com/wp-content/uploads/2011/06/curl.rar" title="curl">这里</a>下载。</p></li>
<li><p> 参考文献：</p></li>
</ol>


<blockquote><p><a href="http://www.roybit.com/wp-content/uploads/2011/06/curl.rar" title="curl">1</a> willko，cURL 二次封装的类库Curl_Manager，</p>

<p>[2] tianxin，php 使用curl模拟登录人人(校内)网，</p></blockquote>
]]></content>
  </entry>
  
</feed>
