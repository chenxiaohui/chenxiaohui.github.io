<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[CXH.ME]]></title>
  <link href="http://cxh.me/atom.xml" rel="self"/>
  <link href="http://cxh.me/"/>
  <updated>2014-12-26T12:09:52+08:00</updated>
  <id>http://cxh.me/</id>
  <author>
    <name><![CDATA[Harry Chen]]></name>
    <email><![CDATA[sdqxcxh@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Maven多模块]]></title>
    <link href="http://cxh.me/2014/12/25/maven-multi-module-project/"/>
    <updated>2014-12-25T20:24:00+08:00</updated>
    <id>http://cxh.me/2014/12/25/maven-multi-module-project</id>
    <content type="html"><![CDATA[<pre><code>mvn exec:java -pl module2 -Dexec.mainClass=MyMain

    &lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;source&gt;1.7&lt;/source&gt;
                &lt;target&gt;1.7&lt;/target&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Thrift依赖和Slf4j]]></title>
    <link href="http://cxh.me/2014/12/25/thrift-and-slf4j/"/>
    <updated>2014-12-25T18:24:00+08:00</updated>
    <id>http://cxh.me/2014/12/25/thrift-and-slf4j</id>
    <content type="html"><![CDATA[<p>  用Thrift做一个分布式系统的RPC，发现跑起来的时候总提示<code>Failed to load class org.slf4j.impl.StaticLoggerBinder</code>，看了看maven依赖感觉没啥问题啊，slf4j-api-xx.jar好好的在呢。分析了maven的依赖，eclipse的问题，最后发现都没问题啊。最后发现还是不了解slf4j，以为跟log4j一样的，其实作为一个proxy，slf4j-api只是一套接口，实现的依赖没有添加进来。</p>

<p>   Thrift的依赖加进来的时候（如下），Dependency Hierachy解析会添加相关的包，但是只添加了slf4j-api，动态编译也不会出错，毕竟接口都有了，但是运行时从classpath找不到对应的包。</p>

<pre><code>  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.thrift&lt;/groupId&gt;
    &lt;artifactId&gt;libthrift&lt;/artifactId&gt;
    &lt;version&gt;0.8.0&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre>

<p>  在上面的基础上要加入一个任意一个slf4j-api的实现：</p>

<pre><code>Placing one (and only one) of slf4j-nop.jar, slf4j-simple.jar, slf4j-log4j12.jar, slf4j-jdk14.jar or logback-classic.jar on the class path should solve the problem.
</code></pre>

<p>  另外libthrift的pom默认依赖的slf4j-api应该是1.5.8，可能会出现如下不兼容的情况：</p>

<pre><code>SLF4J: The requested version 1.5.8 by your slf4j binding is not compatible with [1.6, 1.7]
SLF4J: See http://www.slf4j.org/codes.html#version_mismatch for further details.
</code></pre>

<p>  可以对libthrift的POM加入例外：</p>

<pre><code>&lt;exclusions&gt;
    &lt;exclusion&gt;
        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;/exclusion&gt;
&lt;/exclusions&gt;
</code></pre>

<p>  每个实现详见<a href="http://blog.csdn.net/robert_mm/article/details/8197108" title=" slf4j-api、slf4j-log4j12以及log4j之间什么关系？">参考文献2</a></p>

<h3>参考文献:</h3>

<blockquote><p>[1] SLF4J warning or error messages and their meanings, <a href="http://www.slf4j.org/codes.html#StaticLoggerBinder">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></p>

<p>[2]  slf4j-api、slf4j-log4j12以及log4j之间什么关系？, <a href="http://blog.csdn.net/robert_mm/article/details/8197108">http://blog.csdn.net/robert_mm/article/details/8197108</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于Maven回滚了eclipse中项目的JRE版本]]></title>
    <link href="http://cxh.me/2014/12/25/maven-revert-eclipse-jdk-version/"/>
    <updated>2014-12-25T14:49:00+08:00</updated>
    <id>http://cxh.me/2014/12/25/maven-revert-eclipse-jdk-version</id>
    <content type="html"><![CDATA[<p>  发现在命令行对一个项目执行<code>mvn install</code>的时候，回eclipse看就会有些错误，原因如<a href="http://cxh.me/2014/12/08/eclipse-java-override-warning/" title="关于eclipse里面override上的warning">这里</a>所说，JRE版本和compliance level被回滚到1.5了。查看配置发现，eclipse导入配置并没有设置这里。如下：</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;projectDescription&gt;
    &lt;name&gt;realtime_ua&lt;/name&gt;
    &lt;comment&gt;&lt;/comment&gt;
    &lt;projects&gt;
    &lt;/projects&gt;
    &lt;buildSpec&gt;
        &lt;buildCommand&gt;
            &lt;name&gt;org.eclipse.m2e.core.maven2Builder&lt;/name&gt;
            &lt;arguments&gt;
            &lt;/arguments&gt;
        &lt;/buildCommand&gt;
    &lt;/buildSpec&gt;
    &lt;natures&gt;
        &lt;nature&gt;org.eclipse.m2e.core.maven2Nature&lt;/nature&gt;
    &lt;/natures&gt;
&lt;/projectDescription&gt;
</code></pre>

<p>  实际导入的JRE版本是m2eclipse插件决定的。参考<a href="http://stackoverflow.com/questions/3539139/what-causes-a-new-maven-project-in-eclipse-to-use-java-1-5-instead-of-java-1-6-b" title="What causes a new Maven project in Eclipse to use Java 1.5 instead of Java 1.6 by default and how can I ensure it doesn't?">这里</a>加入对maven-compiler-plugin的默认配置即可：</p>

<pre><code>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
              &lt;source&gt;1.6&lt;/source&gt;
              &lt;target&gt;1.6&lt;/target&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>

<p>  多module项目请把配置直接加在root-project的pom.xml下。</p>

<!--more-->


<h3>参考文献:</h3>

<blockquote><p>[1] 关于eclipse里面override上的warning, <a href="http://cxh.me/2014/12/08/eclipse-java-override-warning/">http://cxh.me/2014/12/08/eclipse-java-override-warning/</a></p>

<p>[2] What causes a new Maven project in Eclipse to use Java 1.5 instead of Java 1.6 by default and how can I ensure it doesn&rsquo;t?, <a href="http://stackoverflow.com/questions/3539139/what-causes-a-new-maven-project-in-eclipse-to-use-java-1-5-instead-of-java-1-6-b">http://stackoverflow.com/questions/3539139/what-causes-a-new-maven-project-in-eclipse-to-use-java-1-5-instead-of-java-1-6-b</a></p>

<p>[3] Solved: Java compiler level does not match the version of the installed Java project facet, <a href="http://howtodoinjava.com/2013/06/04/solved-java-compiler-level-does-not-match-the-version-of-the-installed-java-project-facet/">http://howtodoinjava.com/2013/06/04/solved-java-compiler-level-does-not-match-the-version-of-the-installed-java-project-facet/</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Flash Cookie的跨域读取]]></title>
    <link href="http://cxh.me/2014/12/12/flash-cookie-cross-domain/"/>
    <updated>2014-12-12T12:35:00+08:00</updated>
    <id>http://cxh.me/2014/12/12/flash-cookie-cross-domain</id>
    <content type="html"><![CDATA[<p>  关于Flash Cookie相关的问题见<a href="http://cxh.me/2014/11/25/flash-shared-cookie/" title="跨浏览器cookie">参考文献1</a>。这里主要说如何实现跨域的Flash Cookie读取。</p>

<p>  首先，我们要实现Js调用Flash插件。比较简单的实现是用<a href="https://code.google.com/p/swfobject/" title="swfobject">swfobject</a>。简单的示例代码如下：</p>

<pre><code>&lt;object id="myCom" name="myCom" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="0" height="0"&gt;
    &lt;param name="movie" value="http://xxx/xxx.swf" /&gt;
    &lt;param name="allowScriptAccess" value="always" /&gt;
    &lt;!--[if !IE]&gt;--&gt;
    &lt;object name="myCom" type="application/x-shockwave-flash" data="http://xxx/xxx.swf" width="0" height="0"&gt;
        &lt;param name="allowScriptAccess" value="always" /&gt;
    &lt;!--&lt;![endif]--&gt;
        &lt;div&gt;
            &lt;h1&gt;SWF Cannot be loaded!&lt;/h1&gt;
        &lt;/div&gt;
    &lt;!--[if !IE]&gt;--&gt;
    &lt;/object&gt;
    &lt;!--&lt;![endif]--&gt;
&lt;/object&gt;
</code></pre>

<!--more-->


<p>  js部分代码如下：</p>

<pre><code>    function callbackfn() {
        var obj = swfobject.getObjectById("myCom");
        if (obj &amp;&amp; typeof obj.getXXX != "undefined") {
            alert(obj.getXXX('xxx'));
        }
    };
    swfobject.registerObject("myCom", "9.0.0", "expressInstall.swf");
</code></pre>

<p>  具体含义参见如下swfobject的document：</p>

<ul>
<li>classid (outer object element only, value is always clsid:D27CDB6E-AE6D-11cf-96B8-444553540000)</li>
<li>type (inner object element only, value is always application/x-shockwave-flash)</li>
<li>data (inner object element only, defines the URL of a SWF)</li>
<li>width (both object elements, defines the width of a SWF)</li>
<li>height (both object elements, defines the height of a SWF)</li>
</ul>


<p>  跨域的问题上，需要注意如下几个：</p>

<ol>
<li><p> 调用object的组件的跨域声明是必须的。</p>

<pre><code>&lt;param name="allowScriptAccess" value="always" /&gt;
</code></pre></li>
<li><p> swf_url使用被访问域的swf链接。</p></li>
<li><p> 被访问的域根目录需要开放访问。crossdomain.xml需要开放跨域限制。当然像如下这种粗放的是不好的。（虽然很方便）</p>

<pre><code>&lt;cross-domain-policy&gt;
    &lt;allow-access-from domain="*" /&gt;
&lt;/cross-domain-policy&gt;
</code></pre></li>
<li><p> swf源码需要开放权限：</p>

<pre><code>System.security.allowDomain("yourhtmldomain.com");
</code></pre></li>
</ol>


<p>  OK.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[kafka Consumer API几个问题]]></title>
    <link href="http://cxh.me/2014/12/09/notes-on-kafka-consumer-api/"/>
    <updated>2014-12-09T10:12:00+08:00</updated>
    <id>http://cxh.me/2014/12/09/notes-on-kafka-consumer-api</id>
    <content type="html"><![CDATA[<p>  一直不理解这里的topicCountMap是什么意思。kafka的High Level Consumer API设计实在是比较费解。源码又比较费解。</p>

<pre><code>Map&lt;String, Integer&gt; topicCountMap = new HashMap&lt;String, Integer&gt;();
topicCountMap.put(topic, new Integer(1));
Map&lt;String, List&lt;KafkaStream&lt;byte[], byte[]&gt;&gt;&gt; consumerMap = consumer.createMessageStreams(topicCountMap);
List&lt;KafkaStream&lt;byte[], byte[]&gt;&gt; streams = consumerMap.get(topic);
</code></pre>

<p>  后来查阅到这是跟线程相关的，指定消费每个topic的线程数，然后kafka consumer connector会建立对应的stream流。每个线程对应于一个KafkaStream。一个多线程消费的例子见<a href="http://www.cnblogs.com/fxjwind/p/3794255.html" title="Kafka Consumer接口">参考文献</a>.</p>

<h3>参考文献:</h3>

<blockquote><p>[1] Kafka Consumer接口, <a href="http://www.cnblogs.com/fxjwind/p/3794255.html">http://www.cnblogs.com/fxjwind/p/3794255.html</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于eclipse里面override上的warning]]></title>
    <link href="http://cxh.me/2014/12/08/eclipse-java-override-warning/"/>
    <updated>2014-12-08T16:53:00+08:00</updated>
    <id>http://cxh.me/2014/12/08/eclipse-java-override-warning</id>
    <content type="html"><![CDATA[<p>  写一个Thrift的调用。生成的Thrift代码在eclipse里面打开就报错。如下：</p>

<p>  <img class="center" src="http://cxh.me/images/2014/method_callback.png" title="" ></p>

<p>  看AsyncMethodCallback的代码，没有任何问题啊：</p>

<p>  <img class="center" src="http://cxh.me/images/2014/async_callback.png" title="" ></p>

<p>  后来发现当前项目JRE的版本是1.5，<del>~貌似1.5的JRE有个bug</del>。切到1.6以上版本就可以了。原因如下：</p>

<pre><code>Eclipse is defaulting to Java 1.5 and you have classes implementing interface methods (which in Java 1.6 can be annotated with @Override, but in Java 1.5 can only be applied to methods overriding a superclass method).
</code></pre>

<p>  如果依然有问题，可以直接改一下Compliance Level：</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/compliance.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[thrift和maven/eclipse配置上的几个问题]]></title>
    <link href="http://cxh.me/2014/12/03/ththrift-maven-eclipse-problem/"/>
    <updated>2014-12-03T16:42:00+08:00</updated>
    <id>http://cxh.me/2014/12/03/ththrift-maven-eclipse-problem</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[redis-copy的使用]]></title>
    <link href="http://cxh.me/2014/12/01/redis-copy-usage/"/>
    <updated>2014-12-01T17:01:00+08:00</updated>
    <id>http://cxh.me/2014/12/01/redis-copy-usage</id>
    <content type="html"><![CDATA[<p>  有时候我们需要迁移redis的数据，从本质上看，这基本上是个rehash的过程。我们这里使用<a href="https://github.com/yaauie/redis-copy" title="redis-copy">redis-copy</a>实现。</p>

<p>  简单写一下步骤。首先得有ruby环境，然后直接安装：</p>

<pre><code>gem install redis-copy
</code></pre>

<p>  可能会遇到几个包缺失的问题，如果有报错，安装如下几个包：</p>

<pre><code>gem install redis
gem install hiredis
gem install recommendify
</code></pre>

<p>  简单测试一下redis-copy</p>

<p>  首先建立source和dest redis server：</p>

<pre><code>redis-server redis.src.conf //6379 port
redis-server redis.dst.conf //6380 port
</code></pre>

<p>  redis.conf里面换一下端口就行了。写入几个值</p>

<pre><code>redis-cli -h localhost  -p 6379
select 1
set mykey myvalue
</code></pre>

<p>  然后拷贝src里面db1的所有键值到dst的默认db(0).</p>

<pre><code>sudo redis-copy localhost:6379/1 localhost:6380
</code></pre>

<p>  去dst redis看一下就行了。</p>

<pre><code>redis-cli -h localhost -p 6380
keys *
</code></pre>

<p>  可以看到之前的key-value拷贝过来了。大数据量下的表现明天测一下。</p>

<h3>参考文献:</h3>

<blockquote><p>[1] redis-copy, <a href="https://github.com/yaauie/redis-copy">https://github.com/yaauie/redis-copy</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[跨浏览器cookie]]></title>
    <link href="http://cxh.me/2014/11/25/flash-shared-cookie/"/>
    <updated>2014-11-25T16:57:00+08:00</updated>
    <id>http://cxh.me/2014/11/25/flash-shared-cookie</id>
    <content type="html"><![CDATA[<p>  有时候为了标识一个用户，我们需要跨浏览器的cookie，这样用户在一个浏览器的行为可以被另一个浏览器读取。当然这种行为也备受争议，对于保护用户隐私来讲，这简直是后门。所以cookie里面一定不要存任何重要数据。</p>

<p>  不过这么做也不完全是为了用户数据跟踪。从用户体验的角度看，可以这么实现跨浏览器甚至跨域的session。具体实现上有如下几种方法：</p>

<ol>
<li><p> Local Shared Objects (Flash Cookies)</p></li>
<li><p> Silverlight Isolated Storage</p></li>
<li><p> 使用HTML5客户端储存数据方法。</p></li>
<li><p> evercookie</p></li>
</ol>


<p>  关于第二种有一个解释：一般装了silverlight的人都装了flash，想想真是呵呵了。第三种参见<a href="http://www.zhangxinxu.com/wordpress/2011/09/html5-localstorage%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B/" title="HTML5 localStorage本地存储实际应用举例">参考文献</a>。</p>

<p>  <a href="https://github.com/samyk/evercookie" title="EverCookie">evercookie</a>原则上讲不能算一种方法，而是一种实现。每次写入的时候都会把cookie写到多个地方，下次读取的时候如果发现cookie有丢失，就通过还存在cookie副本来恢复cookie。乍一看原理跟3721那个进程交叉保护差不多，也算是流氓软件了。</p>

<p>  这里我们重点讲第一种。</p>

<!--more-->


<p>  flash cookie使用的是flash自己的本地存储，所以决定于flash实例。大部分浏览器使用的是系统的flash实例，所以flash cookie能跨浏览器存在。但是有几个例外。</p>

<p>  目前实测IE/Maxthon/Firefox/Safari/360浏览器都是采用系统的Flash实例，所以能够共享flash cookie，目前测到的几个特例是chrome/搜狗/百度浏览器，分别采用了自己浏览器内部打包的flash实例。另外不同系统用户的cookie不共享。从下面一张图可以清晰看出：</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/flash_cookie.png"></p>

<p>  flash cookie的写入可以参考如下项目&#8220;，作者在<a href="http://nfriedly.com/techblog/2010/07/swf-for-javascript-cross-domain-flash-cookies/" title="JavaScript library and .swf for cross-domain flash cookies">主页</a>详细说明了使用方法。需要注意的是swf_url控制的写入路径会包含在cookie的namespace里面，也就是说会有如下的目录结构：</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/tree.png"></p>

<p>  另外关于跨域，作者说不同域的js需要使用同一个swf，猜测是js请求swf的时候浏览器不判断在哪个域。swf内部是有跨域安全机制的，如果关闭掉的话，是可以实现请求跨域的。但是js请求其他域的数据会被浏览器拒绝。</p>

<p>  测试如下：</p>

<p>  在两台机器上部署相同的Flash Cookie测试项目，其中61域和74域的js都请求74域的swf：</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/cross.png"></p>

<p>  在74的机器上写入flash cookie: &ldquo;74 write&rdquo;</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/74write.png"></p>

<p>  在61的机器上load:</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/61load.png"></p>

<p>  证明可以跨域读取cookie。</p>

<h3>参考文献:</h3>

<blockquote><p>[1] JavaScript library and .swf for cross-domain flash cookies, <a href="http://nfriedly.com/techblog/2010/07/swf-for-javascript-cross-domain-flash-cookies/">http://nfriedly.com/techblog/2010/07/swf-for-javascript-cross-domain-flash-cookies/</a></p>

<p>[2] Javascript-Flash-Cookies, <a href="https://github.com/nfriedly/Javascript-Flash-Cookies">https://github.com/nfriedly/Javascript-Flash-Cookies</a></p>

<p>[3]  How Facebook Sets and uses cross-Domain cookies, <a href="http://nfriedly.com/techblog/2010/08/how-facebook-sets-and-uses-cross-domain-cookies/">http://nfriedly.com/techblog/2010/08/how-facebook-sets-and-uses-cross-domain-cookies/</a></p>

<p>[4] HTML5 localStorage本地存储实际应用举例, <a href="http://www.zhangxinxu.com/wordpress/2011/09/html5-localstorage%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B/">http://www.zhangxinxu.com/wordpress/2011/09/html5-localstorage%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B/</a></p>

<p>[5] EverCookie, <a href="https://github.com/samyk/evercookie">https://github.com/samyk/evercookie</a></p>

<p>[6] Anehta的水印(Watermark)机制, <a href="http://hi.baidu.com/aullik5/item/89496d121de969041894ecdd">http://hi.baidu.com/aullik5/item/89496d121de969041894ecdd</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[同步/异步/阻塞/非阻塞IO]]></title>
    <link href="http://cxh.me/2014/11/24/non-blocking-io/"/>
    <updated>2014-11-24T14:24:00+08:00</updated>
    <id>http://cxh.me/2014/11/24/non-blocking-io</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从zookeeper提供的特性来看其应用场景]]></title>
    <link href="http://cxh.me/2014/11/20/zookeeper-scene-according-to-feature/"/>
    <updated>2014-11-20T18:59:00+08:00</updated>
    <id>http://cxh.me/2014/11/20/zookeeper-scene-according-to-feature</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[zookeeper配置入门]]></title>
    <link href="http://cxh.me/2014/11/20/zookeeper-configuration-guide/"/>
    <updated>2014-11-20T14:21:00+08:00</updated>
    <id>http://cxh.me/2014/11/20/zookeeper-configuration-guide</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[kafka配置入门]]></title>
    <link href="http://cxh.me/2014/11/20/kafka-configuration-guide/"/>
    <updated>2014-11-20T14:21:00+08:00</updated>
    <id>http://cxh.me/2014/11/20/kafka-configuration-guide</id>
    <content type="html"><![CDATA[<p>producer
metadata.broker.list=localhost:9092,localhost:9093</p>

<p>consumer group</p>

<pre><code>bin/zookeeper-server-start.sh config/zookeeper.properties &gt;/dev/null 2&gt;&amp;1 &amp;
env JMX_PORT=9999 bin/kafka-server-start.sh config/server1.properties &gt;/dev/null 2&gt;&amp;1 &amp;
env JMX_PORT=10000 bin/kafka-server-start.sh config/server2.properties &gt;/dev/null 2&gt;&amp;1 &amp;
sleep 5
bin/kafka-topics.sh --zookeeper localhost:2181 --create --topic mytopic --partitions 2 --replication-factor 2
#bin/kafka-console-producer.sh --broker-list localhost:9092,localhost:9093 --topic mytopic
#bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic mytopic --from-beginning
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[node_zk_browser安装时的一个问题]]></title>
    <link href="http://cxh.me/2014/11/19/error-with-node-zk-browser/"/>
    <updated>2014-11-19T18:56:00+08:00</updated>
    <id>http://cxh.me/2014/11/19/error-with-node-zk-browser</id>
    <content type="html"><![CDATA[<p>  zookeeper基本是基于API和console进行znode的操作，并没有一个比较方便的操作界面，taobao 伯岩大神写过一个工具node_zk_browser，可以比较方便的查询zookeeper信息。地址在</p>

<pre><code>https://github.com/killme2008/node-zk-browser
</code></pre>

<p>  界面如下所示：</p>

<p>  <img class="img-polaroid center" src="http://cxh.me/images/2014/zk_browser.png" title="zk_browser" alt="zk_browser"><p class="align-center">zk_browser</p></p>

<p>  安装的时候遇到一个问题</p>

<pre><code>Downloading zookeeper-3.4.3 from http://apache.mirrors.tds.net/zookeeper/zookeeper-3.4.3/zookeeper-3.4.3.tar.gz
</code></pre>

<p>  这个地址是找不到的。apache的这个mirror上只有3.4.6的包了。改package.json也没用。表示不懂node.js，不知道npm去哪里找的url。</p>

<p>  但是我们可以这样绕过去。先到其他的路径下：</p>

<pre><code>npm install zookeeper
</code></pre>

<p>  这会安装最新的node-zookeeper，安装完毕之后生成一个node_modules目录，下面有一个zookeeper目录，直接复制这个目录到node-zk-browser下面的node_modules目录里。</p>

<p>  搞定。</p>

<h3>参考文献:</h3>

<blockquote><p>[1] Zookeeper的web管理应用, <a href="http://www.blogjava.net/killme2008/archive/2011/06/06/351793.html">http://www.blogjava.net/killme2008/archive/2011/06/06/351793.html</a></p>

<p>[2] node-zookeeper安装小记, <a href="http://blog.izturn.mobi/post/15025383777/node-zookeeper-install-note">http://blog.izturn.mobi/post/15025383777/node-zookeeper-install-note</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[du显示只显示一层子目录/文件的大小]]></title>
    <link href="http://cxh.me/2014/11/13/du-to-display-one-level/"/>
    <updated>2014-11-13T17:55:00+08:00</updated>
    <id>http://cxh.me/2014/11/13/du-to-display-one-level</id>
    <content type="html"><![CDATA[<p>  经常需要看当前目录下的子目录大小，比如开发机被人占满的情况，<code>du -lh</code>显示的是递归的所有文件大小，<code>du -s</code>又只统计了所有文件/文件夹合起来的大小。正常情况下需要执行：</p>

<pre><code>du -lh --max-depth=1
</code></pre>

<p>  未免太过麻烦。后来肖总提示发现这样就行了：</p>

<pre><code>du -sh *
</code></pre>

<p>  果然是学无止境啊</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux下通过markdown写文档的方案]]></title>
    <link href="http://cxh.me/2014/11/13/linux-article-writing/"/>
    <updated>2014-11-13T15:26:00+08:00</updated>
    <id>http://cxh.me/2014/11/13/linux-article-writing</id>
    <content type="html"><![CDATA[<p>  to be continued.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[docker入门]]></title>
    <link href="http://cxh.me/2014/11/11/docker-tutorial/"/>
    <updated>2014-11-11T16:03:00+08:00</updated>
    <id>http://cxh.me/2014/11/11/docker-tutorial</id>
    <content type="html"><![CDATA[<p>  to be continued.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[分布式消息队列的消息消费逻辑]]></title>
    <link href="http://cxh.me/2014/11/07/message-queue-consume-semantics/"/>
    <updated>2014-11-07T14:54:00+08:00</updated>
    <id>http://cxh.me/2014/11/07/message-queue-consume-semantics</id>
    <content type="html"><![CDATA[<p>  引用一段，出处在找：</p>

<p>  对于JMS实现,消息传输担保非常直接:有且只有一次(exactly once).在kafka中稍有不同,对于consumer而言:</p>

<pre><code>1) at most once: 最多一次,这个和JMS中"非持久化"消息类似.发送一次,无论成败,将不会重发.
2) at least once: 消息至少发送一次,如果消息未能接受成功,可能会重发,直到接收成功.
3) exactly once: 消息只会发送一次.
at most once: 消费者fetch消息,然后保存offset,然后处理消息;当client保存offset之后,但是在消息处理过程中consumer进程失效(crash),导致部分消息未能继续处理.那么此后可能其他consumer会接管,但是因为offset已经提前保存,那么新的consumer将不能fetch到offset之前的消息(尽管它们尚没有被处理),这就是"at most once".
at least once: 消费者fetch消息,然后处理消息,然后保存offset.如果消息处理成功之后,但是在保存offset阶段zookeeper异常或者consumer失效,导致保存offset操作未能执行成功,这就导致接下来再次fetch时可能获得上次已经处理过的消息,这就是"at least once".
exactly once: kafka中并没有严格的去实现(基于2阶段提交,事务),我们认为这种策略在kafka中是没有必要的.
因为"消息消费"和"保存offset"这两个操作的先后时机不同,导致了上述3种情况,通常情况下"at-least-once"是我们搜选.(相比at most once而言,重复接收数据总比丢失数据要好).

to be continued.
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[虚函数模板和模板类中的虚函数]]></title>
    <link href="http://cxh.me/2014/10/29/cpp-virtual-template-function/"/>
    <updated>2014-10-29T21:05:00+08:00</updated>
    <id>http://cxh.me/2014/10/29/cpp-virtual-template-function</id>
    <content type="html"><![CDATA[<p>  自从知道了C++不支持虚函数模板之后就觉得相关的一概不支持，今天写程序的时候想把基类做成模板，然后继承基类。以为也不支持，写了一下才发现支持的，无论是非模板类继承一个特化之后的模板还是模板类继承包含虚函数的模板基类都是没问题的。从实现上看，反正使用的时候都会特化的，特化之后虚函数表指针是固定的。不存在像函数模板这种类生成的时候无法确定虚函数表的情况。</p>

<p>  例子如下：</p>

<!--more-->


<pre><code>enum SessionType
{
  ROSession,
  RWSession,
  RPSession
};
class BaseTransCtx
{
  public:
    BaseTransCtx (){}
    virtual ~BaseTransCtx (){}
};
template&lt;typename Type&gt;
class ISessionCtxFactory
{
  public:
    ISessionCtxFactory(){};
    ~ISessionCtxFactory() {};
  public:
    virtual BaseTransCtx *alloc(const Type type) = 0;
    virtual void free(BaseTransCtx *ptr) = 0;
};
typedef ISessionCtxFactory&lt;SessionType&gt; SessionMgr;
class TransSessionMgr: public SessionMgr
{
  public:
    TransSessionMgr (){}
    virtual ~TransSessionMgr (){}

    BaseTransCtx *alloc(const SessionType type)
    {
      return NULL;
    }

    void free(BaseTransCtx *ptr)
    {
      if (ptr != NULL)
      {
        delete ptr;
      }
    }
};
int main(int argc, const char *argv[])
{
  TransSessionMgr trans;
  BaseTransCtx* ctx = trans.alloc(RWSession);
  trans.free(ctx);
  return 0;
}
</code></pre>

<p>  模板类继承虚基类也可以。</p>

<pre><code>template&lt;typename Type&gt;
class ISessionCtxFactory
{
  public:
    ISessionCtxFactory(){};
    ~ISessionCtxFactory() {};
  public:
    virtual BaseTransCtx *alloc(const Type type) = 0;
    virtual void free(BaseTransCtx *ptr) = 0;
};
template&lt;typename Type&gt;
class TransSessionMgr: public ISessionCtxFactory&lt;Type&gt;
{
  public:
    TransSessionMgr (){}
    virtual ~TransSessionMgr (){}

    BaseTransCtx *alloc(const Type type)
    {
      return NULL;
    }

    void free(BaseTransCtx *ptr)
    {
      if (ptr != NULL)
      {
        delete ptr;
      }
    }
};
</code></pre>

<p>  但是这样就不行了</p>

<pre><code>class ISessionCtxFactory
{
  public:
    ISessionCtxFactory(){};
    ~ISessionCtxFactory() {};
  public:
    template&lt;typename Type&gt;
      virtual BaseTransCtx *alloc(const Type type) = 0;
    virtual void free(BaseTransCtx *ptr) = 0;
};
class TransSessionMgr: public ISessionCtxFactory
{
  public:
    TransSessionMgr (){}
    virtual ~TransSessionMgr (){}

    template&lt;typename Type&gt;
      BaseTransCtx *alloc(const Type type)
      {
        return NULL;
      }

    void free(BaseTransCtx *ptr)
    {
      if (ptr != NULL)
      {
        delete ptr;
      }
    }
};
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[澄清几个关于C++继承的问题]]></title>
    <link href="http://cxh.me/2014/10/28/cpp-derive-problems/"/>
    <updated>2014-10-28T15:56:00+08:00</updated>
    <id>http://cxh.me/2014/10/28/cpp-derive-problems</id>
    <content type="html"><![CDATA[<p>  之前讨论编码规范的时候遇到过一个问题，继承的类覆盖基类的虚函数，不写virtual关键字是否依然有覆盖（override)的效果。是个基础问题，但是大家的理解好像都不一样。验证如下：</p>

<pre><code>#include &lt;stdio.h&gt;
class Base
{
  public:
    Base (){}
    virtual ~Base (){}
    virtual void print() {printf("Base\n");}
};

class Middle : public Base
{
  public:
    Middle(){}
    virtual ~Middle(){}
    void print() {printf("Middle\n");}
};

class Derived : public Middle
{
  public:
    Derived(){}
    virtual ~Derived(){}
    void print() {printf("Derived\n");}
};

int main(int argc, const char *argv[])
{
  Base * p = NULL;
  Base b;
  Middle m;
  Derived d;
  p = &amp; b;
  p-&gt;print();
  p = &amp; m;
  p-&gt;print();
  p = &amp; d;
  p-&gt;print();
  return 0;
}
</code></pre>

<!--more-->


<p>  结果是</p>

<pre><code>Base
Middle
Derived
</code></pre>

<p>  可见只要定义了virtual关键字，在整个继承体系中这个函数都会成为虚函数。第二个问题是作为一个中间类（Middle)不想覆盖基类的虚函数，默认的情况下有什么影响。猜想应该就默认用了基类的虚函数。不影响后面的继承关系。注释掉Middle的print函数实现。结果如下：</p>

<pre><code>Base
Base
Derived
</code></pre>

<p>  跟预想一致。水文一篇，可忽略。</p>
]]></content>
  </entry>
  
</feed>
